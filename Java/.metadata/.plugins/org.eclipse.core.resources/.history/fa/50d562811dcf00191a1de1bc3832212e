package cass.oli.revilo;

import java.awt.Canvas;
import java.awt.image.BufferedImage;
import java.io.IOException;

import javax.imageio.ImageIO;

public abstract class Game extends Canvas implements Runnable{
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	public static final int TARGET_FPS = 60;
	final long OPTIMAL_TIME = 1000000000 / TARGET_FPS;
	public static final int WIDTH = 1280, HEIGHT = 720;
	public int width = WIDTH, height = HEIGHT;
	public boolean running, paused, stopped;
	public Revilo revilo = null;
	public BufferedImage[] sprites;
	public int id;
	
	public int mouseX, mouseY;
	public int dragX, dragY;
	public boolean dragging = false;
	
	public Game(Revilo revilo) {
		this.revilo = revilo;
		loadImages();
	}
	
	public Game() {
		loadImages();
	}
	
	private void loadImages() {
		sprites = new BufferedImage[2];
		try {
			sprites[0] = ImageIO.read(getClass().getResource("/res/Home.png"));
			sprites[1] = ImageIO.read(getClass().getResource("/res/Reload.png"));
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	
	public abstract void leftClick(int x, int y);
	public abstract void rightClick(int x, int y);
	public abstract void dragTo(int x, int y);
	protected abstract void tick();
	protected abstract void render() throws Exception;
	
	public void resize() {
		width = this.getWidth();
		height = this.getHeight();
	}
	
	@Override
	public void run() {
		running = true;
		paused = false;
		while(running) {
			long lastTime = System.nanoTime();
			
			if(!paused) tick();
			try {
				render();
			} catch (Exception e1) {
				revilo.setGame(this);
			}
						
			long tick_time = (lastTime - System.nanoTime() + OPTIMAL_TIME)/1000000;
			if(tick_time > 0){
				try{
					Thread.sleep(tick_time);
				}catch(Exception e) {}
			}
		}
	}
}
